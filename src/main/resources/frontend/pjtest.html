<script>
    var _hmt = _hmt || [];
    (function() {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?97653e22175b6597a0db85ab2dab22d1";
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
    })();
</script>
<head>
    <meta charset="UTF-8">
    <title>写系统测试报告</title>
</head>
<body>
<form id="myForm" method="post" action="/pjtest_do">
    <textarea id="dsl" cols="100" rows="25" name="dsl" onkeyup="compile(this)">
用户
注册：导%，入对用户名+密码；注册成功返回首页
登录：导%，入对用户名+密码+验证码；登录成功，显示登录的用户名和头像
公告：导%，能够正确弹出公告对话框；显示公告内容
景区：导%，表%；显%
酒店：导%，表%；显%
特产：导%，表%；显%
新闻：导%，表%；显%
管理员
登录：进%，入对用户名+密码+验证码；登录成功，跳转到后台管理界面
登录：进%，入错用户名+密码+验证码；登录失败，提示用户名或密码错误
图表：导%；能正确显示图表信息
轮播图管理：导%，进行CRUD；实现对CRUD
管理员管理：导%，进行CRUD；实现对CRUD
用户管理：导%，进行CRUD；实现对CRUD
景区管理：导%，进行CRUD；实现对CRUD
酒店管理：导%，进行CRUD；实现对CRUD
</textarea>
    <br>
    <button type="submit"><h3>下载word</h3></button>
</form>
<h4>显示结果</h4>
<div id="compiled"></div>
<script>
    const keywords = {
        "导%":"在%role%导航栏中点击%func%按钮",
        "表%":"点击%func%列表中某一项",
        "显%":"能正确显示%func%列表和%func%具体信息",
        "进%":"进入到%func%画面",
        "CRUD":"%func%信息的增、删、改、查",
    }
    function compile(dslArea){
        let replaced = replaceString(dslArea.value,keywords)
        let newReplaced = ""
        let currentRole = ""
        for (let row of replaced.split("\n")) {
            //只有中文的就是角色
            if(isChineseOnly(row)){
                currentRole = row
                newReplaced += currentRole+"\n"
                continue
            }
            let func = getBeforeColon(row)
            let rep1 = row.replaceAll("%role%",currentRole)
            let rep2 = rep1.replaceAll("%func%",func)
            newReplaced += rep2 +"\n"
        }
        document.getElementById("compiled").innerText = newReplaced
    }
    function replaceString(str, map) {
        var replacedStr = str;
        for (var key in map) {
            var re = new RegExp(key, 'g');
            replacedStr = replacedStr.replace(re, map[key]);
        }
        return replacedStr;
    }
    function isChineseOnly(str) {
        let re = /^[\u4e00-\u9fa5]+$/;
        return re.test(str);
    }
    function getBeforeColon(str) {
        var index = str.indexOf("：");
        if (index !== -1) {
            return str.substring(0, index);
        } else {
            return str;
        }
    }

</script>
</body>